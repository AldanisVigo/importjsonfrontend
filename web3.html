<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body>
  <section class="login-section">
    <button class="login-btn">login</button>
  </section>
  <section class="dashboard-section">
    <span class="wallet-address"></span>
    <span class="wallet-balance"></span>
    <button class="logout-btn">logout</button>
  </section>
</body>
</div>

<!-- Web3.js LIBRARY -->
<script>
const script = document.createElement("script")
script.type = "text/javascript"
script.src = "https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.1/web3.min.js"
document.head.appendChild(script)

 window.userWalletAddress = null;
  window.onload = async (event) => {
    if (window.ethereum) {
      window.web3 = new Web3(window.ethereum);
    } else {
      alert("WEB3 WALLET NOT FOUND");
    }
    window.userWalletAddress = window.localStorage.getItem("userWalletAddress");
    showUserDashboard();
  };
  const loginWithEth = async () => {
    if (window.web3) {
      try {
        const selectedAccount = await window.ethereum
          .request({
            method: "eth_requestAccounts",
          })
          .then((accounts) => accounts[0])
          .catch(() => {
            throw Error("SELECT ACCOUNT");
          });
        window.userWalletAddress = selectedAccount;
        window.localStorage.setItem("userWalletAddress", selectedAccount);
        showUserDashboard();
      } catch (error) {
        alert(error);
      }
    } else {
      alert("WEB3 WALLET NOT FOUND");
    }
  };
  const showUserDashboard = async () => {
    if (!window.userWalletAddress) {
      document.querySelector(".login-section").style.display = "flex";
      document.querySelector(".dashboard-section").style.display = "none";
      return false;
    }
    document.querySelector(".login-section").style.display = "none";
    document.querySelector(".dashboard-section").style.display = "flex";
    showUserWalletAddress();
    getWalletBalance();
  };
  const showUserWalletAddress = () => {
    const walletAddressEl = document.querySelector(".wallet-address");
    walletAddressEl.innerHTML = window.userWalletAddress;
  };
  const getWalletBalance = async () => {
    if (!window.userWalletAddress) {
      return false;
    }
    const balance = await window.web3.eth.getBalance(window.userWalletAddress);
    document.querySelector(".wallet-balance").innerHTML = web3.utils.fromWei(
      balance,
      "ether"
    );
  };
  const logout = () => {
    window.userWalletAddress = null;
    window.localStorage.removeItem("userWalletAddress");
    showUserDashboard();
  };
  document.querySelector(".login-btn").addEventListener("click", loginWithEth);
  document.querySelector(".logout-btn").addEventListener("click", logout);
</script>

</html>